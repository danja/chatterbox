## Chatterbox Design Notes

The target is something comparable to the original [Chatterbox](https://github.com/danja/chatterbox/blob/master/reference/Chatterbox-1976.pdf) but based on a microcontroller and (ultimately) with HTTP-access and MIDI interfaces.

There are a lot of unknowns so a lot of experimentation is needed and **everything here is provisional**. Current status will be in [quasi-blog notes.md](https://github.com/danja/chatterbox/blob/master/notes.md).

![Chatterbox Block Diagram v1](https://github.com/danja/chatterbox/blob/master/media/block-diagram_v1.png "Chatterbox Block Diagram")

## Key
### Generators
 * Wavetable - approximating waveform generated by larynx for voiced sounds
 * Noise - pseudo-random source, for fricatives, sibilants etc.

### Filters
 * F1 - (formant) 1 : bandpass, variable frequency
 * F2 - (formant) 2 : bandpass, variable frequency
 * F3 - filter 3 : high shelf, variable frequency & Q
 * SF1-SF3 : high pass filters, fixed parameters

### Envelope Shapers
 * E0-E4 : simple fixed attack/sustain/decay-driven amplifiers, triggered by switches

### Controls
 * S0 : voiced waveform (most speech)
 * S1 : aspiration waveform (whisper)
 * S2-S4 : unvoiced burst, fixed fricative/sibilant
 * P0 : formant 1 frequency
 * P1 : formant 2 frequency
 * P2 : filter 3 frequency
 * P3 : filter 3 Q
 * P4 : voiced waveform frequency
 * P5 : voiced waveform shape (corresponding to open/closed larynx timing)


### Implementation

The core of the system is an ESP32 system-on-a-chip with external UDA1334A DAC.

I'm coding using the Arduino IDE. Standard libs + ESP32 extensions, plus looking at 3rd party filter implementations.

Simple push switches are used for S0-S4, used to trigger/maintain sounds.

P0 & P1 are the X & Y axes of an analog (potentiometer) joystick.

P2-P4 are potentiometers.

First prototype hardware looks like this:

![Breadboard spaghetti](https://github.com/danja/chatterbox/blob/master/media/prototype1-hardware-breadboard.jpg "Breadboard spaghetti")

Just an ESP32 module and a UDA1334A, lots of spaghetti. 

*Yeah, for now all dumped on a breadboard. Will probably put on stripboard later.*

![Control Panel](https://github.com/danja/chatterbox/blob/master/media/prototype1-hardware-case.jpg "Control Panel")

For a first prototype I've mounted everything on some pieces of thin acrylic I had handy. Once I've decided final controllers etc, will look for something more substantial. I pretty much guessed what I'd be likely to need, based on the original Chatterbox hardware.

* Loudspeaker - I haven't made an amplifier for it yet, will probably use an LM386 or LM380 (and add line out). Currently monitoring with cheap computer speakers.
* Power switch & LED. I don't know yet what kind of PSU will be best - external 9v block or custom split rail for op amps, if I add some analog bits.
* Analog joystick. Rather pricey, but essential IMHO.
* Switches - simple single-pole push. The inputs have ESP32-internal pulldown resistors, the switches all have one terminal to +3.3v, the other to the appropriate GPIO terminal.
* Potentiometers. I hadn't realised I'd be limited to 6 ADCs on the ESP32 so only the joystick and the 4 pots on the right are wired this way (as potential dividers, 3.3v to one terminal, 0v to the other, middle to the ADC in).

I had allowed for one pot for volume control but effectively had the one in the middle left over. But it has occured to me that I can produce a different output on DAC channel 2 (say something from further up the filter chain), direct this passively through the extra control.







